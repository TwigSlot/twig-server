domainName: staging.twigslot.com
env:
  - name: NEO4J_SERVER_URL
    valueFrom:
      secretKeyRef:
        name: flask-credentials
        key: NEO4J_SERVER_URL
        optional: false
  - name: NEO4J_USERNAME
    valueFrom:
      secretKeyRef:
        name: flask-credentials
        key: NEO4J_USERNAME
        optional: false
  - name: NEO4J_PASSWORD
    valueFrom:
      secretKeyRef:
        name: flask-credentials
        key: NEO4J_PASSWORD
        optional: false

kratos:
  kratos:
    config:
      dsn: memory
      secrets:
        default:
          - asdfasdfasdfasdf19219019201920
      selfservice:
        default_browser_return_url: http://localhost:5173
      identity:
        schemas:
          - id: default
            url: file:///etc/config/identity.default.schema.json
      courier:
        smtp:
          connection_uri: smtps://test:test@mailslurper:1025/?skip_ssl_verify=true
    identitySchemas:
      "identity.default.schema.json": |
        {
          "$id": "https://schemas.ory.sh/presets/kratos/identity.email.schema.json",
          "$schema": "http://json-schema.org/draft-07/schema#",
          "title": "Person",
          "type": "object",
          "properties": {
            "traits": {
              "type": "object",
              "properties": {
                "email": {
                  "type": "string",
                  "format": "email",
                  "title": "E-Mail",
                  "ory.sh/kratos": {
                    "credentials": {
                      "password": {
                        "identifier": true
                      }
                    },
                    "recovery": {
                      "via": "email"
                    },
                    "verification": {
                      "via": "email"
                    }
                  }
                }
              },
              "required": [
                "email"
              ],
              "additionalProperties": false
            }
          }
        }
        

kratos-selfservice-ui-node:
  baseUrl: http://baseUrl
  kratosBrowserUrl: http://dev.staging.twigslot.com/auth
  kratosPublicUrl: http://kratos-service:4433/


traefik:
  additionalArguments:
  # Configure your CertificateResolver here...
  #
  # HTTP Challenge
  # ---
  # Generic Example:
  #   - --certificatesresolvers.generic.acme.email=your-email@example.com
  #   - --certificatesresolvers.generic.acme.caServer=https://acme-v02.api.letsencrypt.org/directory
  #   - --certificatesresolvers.generic.acme.httpChallenge.entryPoint=web
  #   - --certificatesresolvers.generic.acme.storage=/ssl-certs/acme-generic.json
  #
  # Prod / Staging Example:
  #   - --certificatesresolvers.staging.acme.email=your-email@example.com
  #   - --certificatesresolvers.staging.acme.caServer=https://acme-staging-v02.api.letsencrypt.org/directory
  #   - --certificatesresolvers.staging.acme.httpChallenge.entryPoint=web
  #   - --certificatesresolvers.staging.acme.storage=/ssl-certs/acme-staging.json
  #   - --certificatesresolvers.production.acme.email=your-email@example.com
  #   - --certificatesresolvers.production.acme.caServer=https://acme-v02.api.letsencrypt.org/directory
  #   - --certificatesresolvers.production.acme.httpChallenge.entryPoint=web
  #   - --certificatesresolvers.production.acme.storage=/ssl-certs/acme-production.json
  #
  # DNS Challenge
  # ---
  # Cloudflare Example:
    - --certificatesresolvers.cloudflare.acme.dnschallenge.provider=cloudflare
    - --certificatesresolvers.cloudflare.acme.email=tanchienhao@gmail.com
    - --certificatesresolvers.cloudflare.acme.dnschallenge.resolvers=1.1.1.1
    - --certificatesresolvers.cloudflare.acme.storage=/ssl-certs/acme-cloudflare.json
  #
  # Generic (replace with your DNS provider):
  #  - --certificatesresolvers.generic.acme.dnschallenge.provider=generic
  #  - --certificatesresolvers.generic.acme.email=your-email@example.com
  #  - --certificatesresolvers.generic.acme.storage=/ssl-certs/acme-generic.json

  logs:
    # Configure log settings here...
    general:
      level: DEBUG

  ports:
    # Configure your entrypoints here...
    web:
    # (optional) Permanent Redirect to HTTPS
      redirectTo: websecure
      nodePort: 32080
    websecure:
      nodePort: 32443
      tls:
        enabled: true
        # (optional) Set a Default CertResolver
        certResolver: cloudflare


  env:
  # Set your environment variables here...
  #
  # DNS Challenge Credentials
  # ---
#   Cloudflare Example:
    - name: CF_API_EMAIL
      valueFrom:
        secretKeyRef:
          key: email
          name: cloudflare-credentials
    - name: CF_API_KEY
      valueFrom:
        secretKeyRef:
          key: apiKey
          name: cloudflare-credentials

  # Disable Dashboard
  ingressRoute:
    dashboard:
      enabled: true

  # Persistent Storage
  persistence:
    enabled: true
    name: ssl-certs
    size: 1Gi
    path: /ssl-certs

  deployment:
    initContainers:
      # The "volume-permissions" init container is required if you run into permission issues.
      # Related issue: https://github.com/containous/traefik/issues/6972
      - name: volume-permissions
        image: busybox:1.31.1
        command: [ "sh", "-c", "chmod -Rv 600 /ssl-certs/*" ]
        volumeMounts:
          - name: ssl-certs
            mountPath: /ssl-certs

  # Set Traefik as your default Ingress Controller, according to Kubernetes 1.19+ changes.
  ingressClass:
    enabled: true
    isDefaultClass: true
